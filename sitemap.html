<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8"/>
        <meta name="description" content="Lady Raccoon - CSS Tricks"/>
        <meta name="keywords" content="Lady Raccoon, Development, Developer, Fullstack, frontend, html, css, tricks, help"/>
        <meta name="author" content="Angele Henry"/>
        <meta name="viewport" content="width=device-width, initial-scale=1"/>
        <link type="text/css" rel="stylesheet" href="./stylesheets/main.css" media="screen"/>
        <link type="text/css" rel="stylesheet" href="./stylesheets/dark.css" media="screen"/>
        <link type="text/css" rel="stylesheet" href="./stylesheets/sitemap.css" media="screen"/>
        <link rel="icon" href="../images/icon.png"/>
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet" type="text/css" integrity="sha384-GLhlTQ8iRABdZLl6O3oVMWSktQOp6b7In1Zl3/Jr59b6EGGoI1aFkw7cmDA6j6gD" crossorigin="anonymous"/>
        <script src="https://kit.fontawesome.com/58515bd467.js" type="text/javascript" crossorigin="anonymous"></script>
        <script src="https://kit.fontawesome.com/58515bd467.js" type="text/javascript" crossorigin="anonymous"></script>
        <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
        <title>Lady Raccoon | CSS Tricks</title>
    </head>
    <body class="custom-scrollbar-css d-flex flex-column">
        <header id="header"></header>

        <main class="main-content">
            <h1>Sitemap</h1>
            <div id="sitemap-container" class="mt-4"></div>
        </main>

        <footer id="footer"></footer>

        <script type="module">
            import * as utils from "/js/utils.js";
            $(document).ready(function(){
                $("#header").load("header.html");
                $("#footer").load("footer.html");

                fetch("./sitemap.xml")
                    .then(response => response.text())
                    .then(xmlText => {
                        const parser = new DOMParser();
                        const xmlDoc = parser.parseFromString(xmlText, "application/xml");
                        generateSitemap(xmlDoc);
                    })
                    .catch(error => console.error("Error fetching XML:", error));
            });

            function generateSitemap(sitemap) {
                    const urls = convertSitemapToJSON(sitemap);
                    const sitemapContainer = document.getElementById("sitemap-container");
                    sitemapContainer.appendChild(generateElement(urls));
                }
                function generateElement(urls) {
                    const urlElement = utils.createElement("ul", null);
                    for (let i = 0; i < urls.length; i++) {
                        const liElement = utils.createTextElement("li", null, null);
                        liElement.appendChild(utils.createTextElement("a", null, urls[i].title, {"href": urls[i].url, "target": "_self"}));
                        if (urls[i].children.length > 0) {
                            liElement.appendChild(generateElement(urls[i].children));
                        }

                        urlElement.appendChild(liElement);
                    }
                    return urlElement;
                }

                function convertSitemapToJSON(xmlDoc) {
                    const urls = Array.from(xmlDoc.getElementsByTagName('loc')).map(node => node.textContent);
                    
                    const baseUrl = urls[0]; // Assuming the first URL is the root (home page)
                    const rootObject = {
                        title: "Home",
                        url: baseUrl,
                        children: []
                    };

                    // Populate children based on whether they are direct descendants of the base URL
                    urls.slice(1).forEach(url => {
                        const title = generateTitleFromUrl(url);
                        rootObject.children.push({
                            title: title,
                            url: url,
                            children: []  // Assuming no deeper nesting for now
                        });
                    });

                    return [rootObject];
                }

                function generateTitleFromUrl(url) {
                    const pathSegments = url.split('/').filter(segment => segment);
                    let title = pathSegments[pathSegments.length - 1]
                        .replace(/-/g, ' ')  // Replace hyphens with spaces
                        .replace(/\b\w/g, char => char.toUpperCase());  // Capitalize each word

                    // Check if title ends with '.' followed by any extension and remove it
                    const dotIndex = title.lastIndexOf('.');
                    if (dotIndex !== -1) {
                        title = title.slice(0, dotIndex);  // Remove the extension (everything after the last dot)
                    }
                    return title;
                }
        </script>
    </body>
</html>
